<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake – Perfect Layout</title>

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    height: 100%;
    background: #111;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: Arial, sans-serif;
    color: white;
}

/* ------------------------------------
   WICHTIG:
   Automatisch kleiner als Fullscreen:
   Oben 4vh Abstand (≈ 1 cm)
   Unten 6vh Abstand (≈ 1,5 cm)
------------------------------------- */
#wrapper {
    width: 94vw;
    height: 90vh;
    margin-top: 4vh;     /* OBERER ABSTAND */
    margin-bottom: 6vh;  /* UNTERER ABSTAND */
    background: #222;
    border: 4px solid #4ea8ff;
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* SCORE */
#scorebar {
    height: 6vh;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: min(5vw, 30px);
    font-weight: bold;
}

/* TRENNLINIE */
#divider {
    width: 100%;
    height: 0.5vh;
    background: #4ea8ff;
}

/* SNAKE FELD */
#gameCanvas {
    width: 100%;
    height: 48vh;            /* Perfekt proportioniert */
    max-height: 48vh;
    background: #222;
    border-bottom: 4px solid #00bfff;
}

/* STEUERUNG */
#ctrlCanvas {
    width: 100%;
    height: 25vh;            /* Platz für Pfeile */
    background: #222;
}
</style>
</head>

<body>
<div id="wrapper">
    <div id="scorebar">Score: 0 | Highscore: 0</div>
    <div id="divider"></div>
    <canvas id="gameCanvas"></canvas>
    <canvas id="ctrlCanvas"></canvas>
</div>

<script>
/* ------------ Snake Game Canvas ------------- */

const gameCanvas = document.getElementById("gameCanvas");
const g = gameCanvas.getContext("2d");

function resizeGame() {
    gameCanvas.width = gameCanvas.clientWidth;
    gameCanvas.height = gameCanvas.clientHeight;
}
resizeGame();
window.addEventListener("resize", resizeGame);

let tileCount = 20;
let snakeX = 10, snakeY = 10;
let velocityX = 0, velocityY = 0;
let snake = [];
let snakeLength = 3;
let foodX = 5, foodY = 5;

let score = 0;
let highscore = Number(localStorage.getItem("snakeHighscore")) || 0;
document.getElementById("scorebar").textContent =
  "Score: " + score + " | Highscore: " + highscore;

let speed = 7;

function gameLoop() {
    setTimeout(() => {
        requestAnimationFrame(gameLoop);
        update();
        draw();
    }, 1000 / speed);
}
gameLoop();

function update() {
    snakeX += velocityX;
    snakeY += velocityY;

    if (snakeX < 0) snakeX = tileCount - 1;
    if (snakeX >= tileCount) snakeX = 0;
    if (snakeY < 0) snakeY = tileCount - 1;
    if (snakeY >= tileCount) snakeY = 0;

    snake.push({ x: snakeX, y: snakeY });
    while (snake.length > snakeLength) snake.shift();

    for (let i = 0; i < snake.length - 1; i++)
        if (snake[i].x === snakeX && snake[i].y === snakeY) resetGame();

    if (snakeX === foodX && snakeY === foodY) {
        snakeLength++;
        score++;

        if (score > highscore) {
            highscore = score;
            localStorage.setItem("snakeHighscore", highscore);
        }

        document.getElementById("scorebar").textContent =
          "Score: " + score + " | Highscore: " + highscore;

        foodX = Math.floor(Math.random() * tileCount);
        foodY = Math.floor(Math.random() * tileCount);
    }
}

function draw() {
    let tileSize = Math.min(
        gameCanvas.clientWidth / tileCount,
        gameCanvas.clientHeight / tileCount
    );

    g.fillStyle = "#222";
    g.fillRect(0, 0, gameCanvas.width, gameCanvas.height);

    g.fillStyle = "#4ea8ff";
    snake.forEach(p => {
        g.fillRect(
            p.x * tileSize,
            p.y * tileSize,
            tileSize - 2,
            tileSize - 2
        );
    });

    g.fillStyle = "lime";
    g.fillRect(
        foodX * tileSize,
        foodY * tileSize,
        tileSize - 2,
        tileSize - 2
    );
}

function resetGame() {
    snakeX = 10;
    snakeY = 10;
    velocityX = 0;
    velocityY = 0;
    snake = [];
    snakeLength = 3;
    score = 0;
    document.getElementById("scorebar").textContent =
      "Score: 0 | Highscore: " + highscore;
}

/* ------------ Controller Canvas ------------- */

const ctrlCanvas = document.getElementById("ctrlCanvas");
const c = ctrlCanvas.getContext("2d");

function resizeCtrl() {
    ctrlCanvas.width = ctrlCanvas.clientWidth;
    ctrlCanvas.height = ctrlCanvas.clientHeight;
    drawControls();
}
resizeCtrl();
window.addEventListener("resize", resizeCtrl);

function drawArrow(x, y, size, angle) {
    c.save();
    c.translate(x, y);
    c.rotate(angle);

    c.lineWidth = size * 0.25;
    c.lineJoin = "round";
    c.lineCap = "round";
    c.strokeStyle = "rgba(0,200,255,0.95)";
    c.shadowBlur = size * 0.45;
    c.shadowColor = "rgba(0,200,255,1)";

    c.beginPath();
    c.moveTo(0, -size);
    c.lineTo(-size * 0.55, size * 0.35);
    c.lineTo(0, -size * 0.1);
    c.lineTo(size * 0.55, size * 0.35);
    c.closePath();
    c.stroke();

    c.restore();
}

function drawControls() {
    c.clearRect(0, 0, ctrlCanvas.width, ctrlCanvas.height);

    let cx = ctrlCanvas.width / 2;
    let cy = ctrlCanvas.height / 2;

    /* ✔ Pfeile bleiben kompakt beisammen */
    let size = ctrlCanvas.height * 0.18;

    drawArrow(cx, cy - size * 1.6, size, 0);
    drawArrow(cx, cy + size * 1.6, size, Math.PI);
    drawArrow(cx - size * 1.9, cy, size, -Math.PI / 2);
    drawArrow(cx + size * 1.9, cy, size, Math.PI / 2);
}

ctrlCanvas.addEventListener("touchstart", e => {
    let r = ctrlCanvas.getBoundingClientRect();
    let x = e.touches[0].clientX - r.left;
    let y = e.touches[0].clientY - r.top;

    let cx = ctrlCanvas.width / 2;
    let cy = ctrlCanvas.height / 2;

    if (y < cy - ctrlCanvas.height * 0.18 && velocityY !== 1)
        velocityX = 0, velocityY = -1;
    else if (y > cy + ctrlCanvas.height * 0.18 && velocityY !== -1)
        velocityX = 0, velocityY = 1;
    else if (x < cx - ctrlCanvas.width * 0.18 && velocityX !== 1)
        velocityX = -1, velocityY = 0;
    else if (x > cx + ctrlCanvas.width * 0.18 && velocityX !== -1)
        velocityX = 1, velocityY = 0;
});

/* KEYBOARD */
document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp" && velocityY !== 1) velocityX = 0, velocityY = -1;
    if (e.key === "ArrowDown" && velocityY !== -1) velocityX = 0, velocityY = 1;
    if (e.key === "ArrowLeft" && velocityX !== 1) velocityX = -1, velocityY = 0;
    if (e.key === "ArrowRight" && velocityX !== -1) velocityX = 1, velocityY = 0;
});
</script>

</body>
</html>
