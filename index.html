<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Snake Game – Fixes Feld + Quadrate</title>

<style>
    body {
        background: #111;
        color: white;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    #gameCanvas {
        width: 99%;
        height: 700px;  /* BLEIBT GROSS */
        background: #222;
        margin-top: 20px;
        border: 3px solid #4ea8ff;
        touch-action: none;
    }

    #score {
        margin-top: 15px;
        font-size: 32px;
        font-weight: bold;
    }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<div id="score">Score: 0</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let tileCount = 20;
let tileSize;

// ===================================
// CANVAS BLEIBT GLEICH, QUADRATE FIX
// ===================================
function resize() {
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;

    // Quadratische Spielfelder
    tileSize = Math.min(
        canvas.width / tileCount,
        canvas.height / tileCount
    );
}
resize();
window.addEventListener("resize", resize);

// ===================================
// VARIABLEN
// ===================================
let snakeX = 10;
let snakeY = 10;
let velocityX = 0;
let velocityY = 0;

let snake = [];
let snakeLength = 3;

let foodX = 5;
let foodY = 5;

let score = 0;

// ===================================
// >>>>>> SNAKE SPEED HIER ÄNDERN <<<<<<
// ===================================
let speed = 9;   // <<< HIER ÄNDERN: z.B. 5 langsam, 12 schnell, 20 sehr schnell
// ===================================


// ===================================
// GAME LOOP
// ===================================
function game() {
    setTimeout(() => {
        requestAnimationFrame(game);
        update();
        draw();
    }, 1000 / speed);   // ← Speed wird HIER benutzt
}
game();

// ===================================
// UPDATE
// ===================================
function update() {
    snakeX += velocityX;
    snakeY += velocityY;

    // Teleport an Rändern
    if (snakeX < 0) snakeX = tileCount - 1;
    if (snakeX >= tileCount) snakeX = 0;
    if (snakeY < 0) snakeY = tileCount - 1;
    if (snakeY >= tileCount) snakeY = 0;

    snake.push({ x: snakeX, y: snakeY });
    while (snake.length > snakeLength) snake.shift();

    // Selbstkollision
    for (let i = 0; i < snake.length - 1; i++) {
        if (snake[i].x === snakeX && snake[i].y === snakeY) resetGame();
    }

    // Essen
    if (snakeX === foodX && snakeY === foodY) {
        snakeLength++;
        score++;
        document.getElementById("score").textContent = "Score: " + score;

        foodX = Math.floor(Math.random() * tileCount);
        foodY = Math.floor(Math.random() * tileCount);
    }
}

// ===================================
// ZEICHNEN
// ===================================
function draw() {
    ctx.fillStyle = "#222";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Snake (quadratisch)
    ctx.fillStyle = "#4ea8ff";
    snake.forEach(p => {
        ctx.fillRect(
            p.x * tileSize,
            p.y * tileSize,
            tileSize - 2,
            tileSize - 2
        );
    });

    // Essen (quadratisch)
    ctx.fillStyle = "lime";
    ctx.fillRect(
        foodX * tileSize,
        foodY * tileSize,
        tileSize - 2,
        tileSize - 2
    );
}

// ===================================
// RESET
// ===================================
function resetGame() {
    snakeX = 10;
    snakeY = 10;
    velocityX = 0;
    velocityY = 0;
    snake = [];
    snakeLength = 3;
    score = 0;
    document.getElementById("score").textContent = "Score: 0";
}

// ===================================
// TASTATUR STEUERUNG
// ===================================
document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp" && velocityY !== 1) {
        velocityX = 0; velocityY = -1;
    }
    if (e.key === "ArrowDown" && velocityY !== -1) {
        velocityX = 0; velocityY = 1;
    }
    if (e.key === "ArrowLeft" && velocityX !== 1) {
        velocityX = -1; velocityY = 0;
    }
    if (e.key === "ArrowRight" && velocityX !== -1) {
        velocityX = 1; velocityY = 0;
    }
});

// ===================================
// TOUCH STEUERUNG
// ===================================
let startX = 0, startY = 0;

canvas.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
});

canvas.addEventListener("touchmove", e => {
    let dx = e.touches[0].clientX - startX;
    let dy = e.touches[0].clientY - startY;

    if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 0 && velocityX !== -1) velocityX = 1, velocityY = 0;
        else if (dx < 0 && velocityX !== 1) velocityX = -1, velocityY = 0;
    } else {
        if (dy > 0 && velocityY !== -1) velocityX = 0, velocityY = 1;
        else if (dy < 0 && velocityY !== 1) velocityX = 0, velocityY = -1;
    }

    startX = e.touches[0].clientX;
    startY = e.touches[0].clientY;
});
</script>

</body>
</html>
