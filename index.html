<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<title>Snake Game</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
    height: 100%;
    background: #05bd8c;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: monospace;
    overflow: hidden;
}

/* WRAPPER */
#wrapper {
    width: 100%;
    height: calc(var(--vh) * 100);
    max-width: 100%;
    background: #bfeab3;
    border: 4px solid #121510;
    border-radius: 15px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* SCOREBAR */
#scorebar {
    height: calc(var(--vh) * 7);
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:min(6vw,15px);
    font-weight:bold;
    background:#7ef354;
    color:#000;
}

/* LINE */
#divider {
    width:100%;
    height: calc(var(--vh) * 0.8);
    background:#10120f;
}

/* SPIELFELD */
#gameCanvas {
    width: 100%;
    flex-grow: 1;
    background:#e5f2e0;
    border-bottom:3px solid #0a0c08;
    image-rendering: pixelated;
    touch-action: none;
}

/* STEUERUNG */
#buttons {
    height: calc(var(--vh) * 30);
    background: #1d3811;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    max-height: 33vh;
}

.btn-row {
    display: flex;
    justify-content: center;
    align-items: center;
}

/* Auto-Scaling Buttons */
.ctrl-btn {
    width: calc(var(--vh) * 10);
    height: calc(var(--vh) * 10);
    font-size: calc(var(--vh) * 7);
    border: 3px solid #000;
    background: #7ef354;
    border-radius: 12px;

    display:flex;
    justify-content:center;
    align-items:center;

    user-select:none;
    touch-action: manipulation;
}

.ctrl-btn:active {
    background: #57d336;
}

#center {
    width: calc(var(--vh) * 10);
    height: calc(var(--vh) * 10);
    background: transparent;
    border: none;
}
</style>
</head>

<body>

<script>
/* --- Fix 1% Viewport Bug (wichtig für Handy!) --- */
function fixVH() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty("--vh", `${vh}px`);
}
fixVH();
window.addEventListener("resize", fixVH);
window.addEventListener("orientationchange", () => setTimeout(fixVH, 300));
</script>

<div id="wrapper">

    <div id="scorebar">Score: 0 | Highscore: 0</div>
    <div id="divider"></div>

    <canvas id="gameCanvas"></canvas>

    <div id="buttons">
        <div class="btn-row">
            <div class="ctrl-btn" id="up">⬆</div>
        </div>
        <div class="btn-row">
            <div class="ctrl-btn" id="left">⬅</div>
            <div class="ctrl-btn" id="center"></div>
            <div class="ctrl-btn" id="right">➡</div>
        </div>
        <div class="btn-row">
            <div class="ctrl-btn" id="down">⬇</div>
        </div>
    </div>

</div>

<script>
/* CANVAS */
const canvas = document.getElementById("gameCanvas");
const g = canvas.getContext("2d");

function resizeGame() {
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
}
resizeGame();
window.addEventListener("resize", resizeGame);

let tileCount = 20;
let snakeX = 10, snakeY = 10;
let velocityX = 0, velocityY = 0;
let snake = [];
let snakeLength = 3;

let foodX = 5, foodY = 5;

let score = 0;
let highscore = Number(localStorage.getItem("snakeHighscore")) || 0;

function updateScorebar() {
    document.getElementById("scorebar").textContent =
    `Score: ${score} | Highscore: ${highscore}`;
}
updateScorebar();

let speed = 7;

/* MAIN LOOP */
function gameLoop() {
    setTimeout(() => {
        requestAnimationFrame(gameLoop);
        update();
        draw();
    }, 1000 / speed);
}
gameLoop();

/* UPDATE */
function update() {
    snakeX += velocityX;
    snakeY += velocityY;

    if (snakeX < 0) snakeX = tileCount - 1;
    if (snakeX >= tileCount) snakeX = 0;
    if (snakeY < 0) snakeY = tileCount - 1;
    if (snakeY >= tileCount) snakeY = 0;

    snake.push({ x: snakeX, y: snakeY });
    while (snake.length > snakeLength) snake.shift();

    for (let i = 0; i < snake.length - 1; i++) {
        if (snake[i].x === snakeX && snake[i].y === snakeY) {
            resetGame();
        }
    }

    if (snakeX === foodX && snakeY === foodY) {
        snakeLength++;
        score++;

        if (score > highscore) {
            highscore = score;
            localStorage.setItem("snakeHighscore", highscore);
        }
        updateScorebar();

        foodX = Math.floor(Math.random() * tileCount);
        foodY = Math.floor(Math.random() * tileCount);
    }
}

/* DRAW */
function draw() {
    const tileSize = Math.min(
        canvas.clientWidth / tileCount,
        canvas.clientHeight / tileCount
    );

    const gap = tileSize * 0.12;
    const size = tileSize - gap * 2;
    const radius = size * 0.18;

    g.fillStyle = "#c6ffb3";
    g.fillRect(0, 0, canvas.width, canvas.height);

    g.fillStyle = "#2e2e2e";
    snake.forEach(p => {
        g.beginPath();
        g.roundRect(
            p.x * tileSize + gap,
            p.y * tileSize + gap,
            size,
            size,
            radius
        );
        g.fill();
    });

    const foodSize = size * 0.7;
    const foodRadius = foodSize * 0.2;
    const offset = (tileSize - foodSize) / 2;

    g.beginPath();
    g.roundRect(
        foodX * tileSize + offset,
        foodY * tileSize + offset,
        foodSize,
        foodSize,
        foodRadius
    );
    g.fill();
}

/* RESET */
function resetGame() {
    snakeX = 10;
    snakeY = 10;
    velocityX = 0;
    velocityY = 0;
    snake = [];
    snakeLength = 3;

    updateScorebar(); // Score bleibt stehen!
}

/* TOUCH + PC-STEUERUNG */
function startMove(nx, ny) {
    if (velocityX === 0 && velocityY === 0 && (nx !== 0 || ny !== 0)) {
        score = 0;
        updateScorebar();
    }
    velocityX = nx;
    velocityY = ny;
}

document.getElementById("up").addEventListener("click", () => {
    if (velocityY !== 1) startMove(0, -1);
});
document.getElementById("down").addEventListener("click", () => {
    if (velocityY !== -1) startMove(0, 1);
});
document.getElementById("left").addEventListener("click", () => {
    if (velocityX !== 1) startMove(-1, 0);
});
document.getElementById("right").addEventListener("click", () => {
    if (velocityX !== -1) startMove(1, 0);
});

document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp" && velocityY !== 1) startMove(0, -1);
    if (e.key === "ArrowDown" && velocityY !== -1) startMove(0, 1);
    if (e.key === "ArrowLeft" && velocityX !== 1) startMove(-1, 0);
    if (e.key === "ArrowRight" && velocityX !== -1) startMove(1, 0);
});
</script>

</body>
</html>


