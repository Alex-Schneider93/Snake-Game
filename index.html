<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nokia LCD Snake â€“ Touch Fixed</title>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

html, body {
    height: 100%;
    background: #1a1f1a;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: monospace;
}

/* Display Container */
#display {
    width: 92vw;
    max-width: 430px;
    height: 88vh;
    background: #2d3a2d;
    border: 6px solid #252d25;
    border-radius: 14px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* LCD Bereich */
#screen {
    flex: 1;
    background: #c6ffb3;
    display: flex;
    flex-direction: column;
}

#scorebar {
    height: 36px;
    background: #b1eaa2;
    border-bottom: 2px solid #88c98a;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
}

#divider {
    height: 3px;
    background: #88c98a;
}

/* Snake Spielfeld */
#gameCanvas {
    width: 100%;
    height: calc(100% - 39px);
    background: #c6ffb3;
    image-rendering: pixelated;
}

/* Steuerfeld */
#controls {
    height: 22%;
    background: #3c4440;
    border-top: 4px solid #252d25;
}

#ctrlCanvas {
    width: 100%;
    height: 100%;
    background: #3c4440;
}
</style>
</head>
<body>

<div id="display">

    <!-- LCD -->
    <div id="screen">
        <div id="scorebar">Score: 0 | Highscore: 0</div>
        <div id="divider"></div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- KEYPAD -->
    <div id="controls">
        <canvas id="ctrlCanvas"></canvas>
    </div>

</div>

<script>
/* ==============================
   GAME CANVAS (Pixel Fix)
============================== */
const gameCanvas = document.getElementById("gameCanvas");
const g = gameCanvas.getContext("2d");

function resizeGame() {
    gameCanvas.width = Math.floor(gameCanvas.clientWidth) + 2; 
    gameCanvas.height = Math.floor(gameCanvas.clientHeight);
}
resizeGame();
window.addEventListener("resize", () => { resizeGame(); resizeCtrl(); });

/* ==============================
   SNAKE LOGIK
============================== */
let tileCount = 20;
let snakeX = 10, snakeY = 10;
let velocityX = 0, velocityY = 0;
let snake = [];
let snakeLength = 3;

let foodX = 5, foodY = 5;

let score = 0;
let highscore = Number(localStorage.getItem("lcdSnakeHighscore")) || 0;

document.getElementById("scorebar").textContent =
"Score: " + score + " | Highscore: " + highscore;

let speed = 7;

function gameLoop() {
    setTimeout(() => {
        requestAnimationFrame(gameLoop);
        update();
        draw();
    }, 1000 / speed);
}
gameLoop();

/* UPDATE */
function update() {
    snakeX += velocityX;
    snakeY += velocityY;

    if (snakeX < 0) snakeX = tileCount - 1;
    if (snakeX >= tileCount) snakeX = 0;
    if (snakeY < 0) snakeY = tileCount - 1;
    if (snakeY >= tileCount) snakeY = 0;

    snake.push({ x: snakeX, y: snakeY });
    while (snake.length > snakeLength) snake.shift();

    for (let i = 0; i < snake.length - 1; i++)
        if (snake[i].x === snakeX && snake[i].y === snakeY)
            resetGame();

    if (snakeX === foodX && snakeY === foodY) {
        snakeLength++;
        score++;

        if (score > highscore) {
            highscore = score;
            localStorage.setItem("lcdSnakeHighscore", highscore);
        }

        document.getElementById("scorebar").textContent =
        "Score: " + score + " | Highscore: " + highscore;

        foodX = Math.floor(Math.random() * tileCount);
        foodY = Math.floor(Math.random() * tileCount);
    }
}

/* DRAW */
function draw() {
    const tileSize = Math.min(
        gameCanvas.clientWidth / tileCount,
        gameCanvas.clientHeight / tileCount
    );

    g.fillStyle = "#c6ffb3";
    g.fillRect(0, 0, gameCanvas.width + 2, gameCanvas.height);

    g.fillStyle = "#2d3a2d";
    snake.forEach(p => {
        g.fillRect(
            Math.floor(p.x * tileSize),
            Math.floor(p.y * tileSize),
            Math.floor(tileSize - 1),
            Math.floor(tileSize - 1)
        );
    });

    g.fillStyle = "#4f6e4f";
    g.fillRect(
        Math.floor(foodX * tileSize),
        Math.floor(foodY * tileSize),
        Math.floor(tileSize - 1),
        Math.floor(tileSize - 1)
    );
}

function resetGame() {
    snakeX = 10;
    snakeY = 10;
    velocityX = 0;
    velocityY = 0;
    snake = [];
    snakeLength = 3;
    score = 0;

    document.getElementById("scorebar").textContent =
    "Score: 0 | Highscore: " + highscore;
}

/* ==============================
   CONTROLLER CANVAS (Touch FIX)
============================== */
const ctrlCanvas = document.getElementById("ctrlCanvas");
const c = ctrlCanvas.getContext("2d");

let pressedArrow = null;
let pressTimeout = null;

function resizeCtrl() {
    ctrlCanvas.width = ctrlCanvas.clientWidth;
    ctrlCanvas.height = ctrlCanvas.clientHeight;
    drawControls();
}
resizeCtrl();

/* Pfeil-Zeichnung + Klickanimation */
function drawArrow(x, y, s, angle, pressed) {
    c.save();
    c.translate(x, y);
    c.rotate(angle);

    c.lineWidth = s * 0.22;
    c.lineJoin = "round";
    c.strokeStyle = pressed ? "#88c98a" : "#c6ffb3";

    c.beginPath();
    c.moveTo(0, -s);
    c.lineTo(-s * 0.55, s * 0.35);
    c.lineTo(0, -s * 0.1);
    c.lineTo(s * 0.55, s * 0.35);
    c.closePath();
    c.stroke();

    c.restore();
}

/* Zeichnet alle Pfeile */
function drawControls() {
    c.fillStyle = "#3c4440";
    c.fillRect(0, 0, ctrlCanvas.width, ctrlCanvas.height);

    let cx = ctrlCanvas.width / 2;
    let cy = ctrlCanvas.height / 2;
    let s = ctrlCanvas.height * 0.20;

    drawArrow(cx, cy - s * 1.3, s, 0, pressedArrow === "up");
    drawArrow(cx, cy + s * 1.3, s, Math.PI, pressedArrow === "down");
    drawArrow(cx - s * 1.7, cy, s, -Math.PI / 2, pressedArrow === "left");
    drawArrow(cx + s * 1.7, cy, s, Math.PI / 2, pressedArrow === "right");
}

/* TOUCHSTEUERUNG */
ctrlCanvas.addEventListener("touchstart", e => {
    const r = ctrlCanvas.getBoundingClientRect();
    const x = e.touches[0].clientX - r.left;
    const y = e.touches[0].clientY - r.top;

    const cx = ctrlCanvas.width / 2;
    const cy = ctrlCanvas.height / 2;

    const threshold = ctrlCanvas.height * 0.18;

    if (y < cy - threshold) {
        if (velocityY !== 1) {
            velocityX = 0; velocityY = -1;
            pressedArrow = "up";
        }
    }
    else if (y > cy + threshold) {
        if (velocityY !== -1) {
            velocityX = 0; velocityY = 1;
            pressedArrow = "down";
        }
    }
    else if (x < cx - threshold) {
        if (velocityX !== 1) {
            velocityX = -1; velocityY = 0;
            pressedArrow = "left";
        }
    }
    else if (x > cx + threshold) {
        if (velocityX !== -1) {
            velocityX = 1; velocityY = 0;
            pressedArrow = "right";
        }
    }

    drawControls();

    clearTimeout(pressTimeout);
    pressTimeout = setTimeout(() => {
        pressedArrow = null;
        drawControls();
    }, 120);
});

/* PC Tastatur */
document.addEventListener("keydown", e => {
    if (e.key === "ArrowUp" && velocityY !== 1) velocityX = 0, velocityY = -1;
    if (e.key === "ArrowDown" && velocityY !== -1) velocityX = 0, velocityY = 1;
    if (e.key === "ArrowLeft" && velocityX !== 1) velocityX = -1, velocityY = 0;
    if (e.key === "ArrowRight" && velocityX !== -1) velocityX = 1, velocityY = 0;
});
</script>

</body>
</html>
